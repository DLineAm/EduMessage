<Page
    x:Class="EduMessage.Pages.EducationCourseListPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:EduMessage.Pages"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" xmlns:signalirservertest="using:SignalIRServerTest" xmlns:controls="using:Microsoft.UI.Xaml.Controls"
    mc:Ignorable="d"
      xmlns:Interactivity="using:Microsoft.Xaml.Interactivity"
  xmlns:Core="using:Microsoft.Xaml.Interactions.Core" xmlns:viewmodels="using:EduMessage.ViewModels"
    x:Name="window">

    <Grid Margin="-12,0">
        <Grid.ColumnDefinitions>
            <ColumnDefinition/>
            <ColumnDefinition Width="auto"/>
        </Grid.ColumnDefinitions>
        <ListView ItemsSource="{Binding Courses}"
                  HorizontalContentAlignment="Stretch"
                  ScrollViewer.VerticalScrollBarVisibility="Auto"
                         ScrollViewer.VerticalScrollMode="Enabled"
                              SelectionMode="None">
            <ListView.ItemContainerStyle>
                <Style TargetType="ListViewItem">
                    <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                </Style>
            </ListView.ItemContainerStyle>
            <ListView.ItemTemplate>
                <DataTemplate x:DataType="viewmodels:CourseFiles">
                    <Grid HorizontalAlignment="Stretch"
                          x:Name="CourseGrid"
                          MinHeight="65"
                          Background="Transparent">
                        <Interactivity:Interaction.Behaviors>
                            <Core:EventTriggerBehavior EventName="PointerEntered">
                                <Core:ChangePropertyAction TargetObject="{Binding ElementName=BarButton}" PropertyName="Visibility" Value="Visible"/>
                            </Core:EventTriggerBehavior>
                            <Core:EventTriggerBehavior EventName="PointerExited">
                                <Core:ChangePropertyAction TargetObject="{Binding ElementName=BarButton}" PropertyName="Visibility" Value="Collapsed"/>
                            </Core:EventTriggerBehavior>
                        </Interactivity:Interaction.Behaviors>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition/>
                            <ColumnDefinition Width="80"/>
                        </Grid.ColumnDefinitions>
                        <controls:Expander HorizontalAlignment="Stretch"
                                           VerticalAlignment="Stretch"
                                           Margin="0,5,0,0"
                                           HorizontalContentAlignment="Left">
                            <controls:Expander.Header>
                                <Grid Height="50">
                                    <TextBlock VerticalAlignment="Center">
                                    <Run Text="Тема "/>
                                    <Run Text="{Binding Course.Id}"/>
                                    <Run Text=". "/>
                                    <Run Text="{Binding Course.Title}"/>
                                    </TextBlock>
                                </Grid>
                            </controls:Expander.Header>
                            <controls:Expander.Content>
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition></RowDefinition>
                                        <RowDefinition Height="Auto"></RowDefinition>
                                    </Grid.RowDefinitions>
                                    <TextBlock Text="{Binding Course.Description}"
                                               TextWrapping="Wrap"/>

                                    <StackPanel Grid.Row="1"
                                                Visibility="{Binding FilesInfoVisibility}">
                                        <TextBlock Text="Прикрепленные файлы"
                                                   Margin="0,12"
                                                   Foreground="{ThemeResource TextBoxButtonForegroundThemeBrush}"></TextBlock>
                                        <ListView ItemsSource="{Binding Files}">
                                            <ListView.ItemsPanel>
                                                <ItemsPanelTemplate>
                                                    <StackPanel Orientation="Horizontal"></StackPanel>
                                                </ItemsPanelTemplate>
                                            </ListView.ItemsPanel>
                                            <ListView.ItemTemplate>
                                                <DataTemplate>
                                                    <Border Background="Transparent">
                                                        <Interactivity:Interaction.Behaviors>
                                                            <Core:EventTriggerBehavior EventName="DoubleTapped">
                                                                <Core:EventTriggerBehavior.Actions>
                                                                    <Core:InvokeCommandAction Command="{Binding DataContext.OpenFileCommand, ElementName=window}"
                                                                        CommandParameter="{Binding }"></Core:InvokeCommandAction>
                                                                </Core:EventTriggerBehavior.Actions>
                                                            </Core:EventTriggerBehavior>
                                                        </Interactivity:Interaction.Behaviors>
                                                        <StackPanel>
                                                            <Image Source="{Binding ImagePath}"
                                                                   Height="32"></Image>
                                                            <TextBlock HorizontalAlignment="Center"
                                                                       TextAlignment="Center"
                                                                       Text="{Binding Name}"
                                                                       Width="70"
                                                                       TextTrimming="CharacterEllipsis"></TextBlock>
                                                        </StackPanel>
                                                    </Border>
                                                </DataTemplate>
                                            </ListView.ItemTemplate>
                                        </ListView>
                                    </StackPanel>
                                </Grid>
                                
                            </controls:Expander.Content>
                        </controls:Expander>

                        <AppBarButton Grid.Column="1"
                                     Icon="Delete"
                                      Label="Удалить"
                                      x:Name="BarButton"
                                     Visibility="Collapsed">
                            <AppBarButton.Flyout>
                                <Flyout>
                                    <StackPanel>
                                        <TextBlock Style="{ThemeResource BaseTextBlockStyle}">
                                            <Run Text="Вы действительно хотите удалить курс "/>
                                            <Run Text="{Binding Course.Id}"/>
                                            <Run Text="?"/>
                                        </TextBlock>
                                        <StackPanel Orientation="Horizontal"
                                                    Margin="0,12,0,0">
                                            <Button Content="Да, удалить"
                                                    Command="{Binding DataContext.DeleteCourseCommand, ElementName=window}"
                                                    CommandParameter="{Binding }"/>
                                        </StackPanel>
                                    </StackPanel>
                                </Flyout>
                            </AppBarButton.Flyout>
                        </AppBarButton>
                    </Grid>
                </DataTemplate>
            </ListView.ItemTemplate>
        </ListView>

        <Border Grid.Column="1"
                Padding="12">
            <Grid >
                <Grid.RowDefinitions>
                    <RowDefinition Height="auto"/>
                    <RowDefinition />
                </Grid.RowDefinitions>
                
                <TextBlock Text="Действия"
                           Style="{StaticResource 26TitleTextBlock}"/>

                <StackPanel Grid.Row="1"
                            Margin="0,12,0,0">
                    <HyperlinkButton Content="Добавить курс"
                                     Click="HyperlinkButton_Click"/>
                </StackPanel>
            </Grid>
        </Border>

        <ContentDialog Grid.ColumnSpan="2"
                       Title="Добавление курса"
                       PrimaryButtonText="Добавить"
                       PrimaryButtonCommand="{Binding ApplyCommand}"
                       SecondaryButtonText="Отмена"
                       x:Name="CourseAddDialog">
            <StackPanel Margin="0,12,0,0">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="Название"/>
                    <TextBox Width="400"
                             Margin="12,0"
                             Text="{Binding CourseTitle, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                </StackPanel>
                <StackPanel Orientation="Horizontal"
                            Margin="0,12">
                    <TextBlock Text="Описание"/>
                    <TextBox Width="400"
                                 Height="300"
                                 Margin="12,0"
                                 TextWrapping="Wrap"
                             Text="{Binding CourseDescription, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                </StackPanel>
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="auto"/>
                        <RowDefinition Height="auto"/>
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="auto"/>
                        <ColumnDefinition/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Text="Файлы"
                               VerticalAlignment="Center"/>
                    <ListView Width="400"
                              ItemsSource="{Binding Files}"
                              Margin="0,0,0,0"
                              Grid.Column="1"
                              ScrollViewer.HorizontalScrollBarVisibility="Visible">
                        <ListView.ItemsPanel>
                            <ItemsPanelTemplate>
                                <StackPanel Orientation="Horizontal"/>
                            </ItemsPanelTemplate>
                        </ListView.ItemsPanel>
                        <ListView.ItemTemplate>
                            <DataTemplate x:DataType="viewmodels:EducationFile">
                                <Grid>
                                    
                                    <StackPanel Width="100"
                                            Margin="0,5">
                                        <Image Source="{Binding ImagePath}"
                                           Height="48"
                                           Width="48"/>
                                        <TextBlock Text="{Binding Name}"
                                               TextTrimming="CharacterEllipsis"
                                               HorizontalAlignment="Center"/>
                                    </StackPanel>
                                    <Button HorizontalAlignment="Right"
                                            VerticalAlignment="Top"
                                            Background="{ThemeResource SystemControlAcrylicElementBrush}"
                                            Command="{Binding DataContext.DeleteFileCommand, ElementName=window}"
                                            CommandParameter="{Binding }">
                                        <Button.Content>
                                            <Viewbox Height="15">
                                                <SymbolIcon Symbol="Delete"/>
                                            </Viewbox>
                                        </Button.Content>
                                    </Button>
                                </Grid>
                                
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>
                    <AppBarButton Grid.Row="1"
                                  Label="Очистить"
                                  Icon="Delete"
                                  VerticalAlignment="Stretch"
                                  VerticalContentAlignment="Bottom"
                                  IsEnabled="{Binding DataContext.IsClearButtonEnabled, ElementName=window}"
                                  Command="{Binding CleanFilesListCommand}">
                        
                    </AppBarButton>
                    <local:ItemsPickPage Height="100"
                                     Width="400"
                                     Margin="0,12,0,0"
                                         Grid.Row="1"
                                         Grid.Column="1"/>
                </Grid>
                <StackPanel Orientation="Horizontal"
                            Margin="0,12">
                   
                </StackPanel>
                
            </StackPanel>
        </ContentDialog>

    </Grid>
</Page>
